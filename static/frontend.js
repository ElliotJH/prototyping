/*
Places (Find my nearest)
*/
var setup_places=function(){var a=new AlphaGeoForm("#local-locator-form"),b=function(){$(".further_information").hide(),$("#options-loading").removeClass("hidden"),$.ajax({url:(document.location+".json").replace(/\/\.json$/,".json"),dataType:"json",data:{lat:AlphaGeo.full_location.current_location.lat,lon:AlphaGeo.full_location.current_location.lon},type:"POST",success:function(a){$("#options-loading").addClass("hidden"),a.places.length>0?($("h3#options-header").show().removeClass("hidden"),$("#options").html($.mustache($("#option-template").html(),{options:a.places}))):$("#results-error").removeClass("hidden").find("p").text("Sorry, no results were found near you."),_gaq.push(["_trackEvent","Citizen-Format-Findmynearest","Success-results"]),$("#options-header").show()}})},c=function(){$("#options").html(""),$("#options-header").hide(),$("#results-error").addClass("hidden")};$(AlphaGeo).bind("location-removed",function(a,b){c(),$(".further_information").show()}),$(AlphaGeo).bind("location-completed",function(a,d){c(),$("strong.locality_placeholder").text(AlphaGeo.full_location.current_location.locality),b()})};$(function(){$("#wrapper").attr("class").match(/place/)&&setup_places()});var setup_local_transactions=function(){function c(){$("#no-provider-error").addClass("hidden"),$("#authority-contact").addClass("hidden"),$(".location-placeholder").text(AlphaGeo.full_location.current_location.councils[0].name),$("#location-loading").removeClass("hidden");var a={lat:AlphaGeo.full_location.current_location.lat,lon:AlphaGeo.full_location.current_location.lon};AlphaGeo.full_location.current_location.council&&(a.council_ons_codes=$.map(AlphaGeo.full_location.current_location.council,function(a){return a.ons}));var c=document.location+".json",d;$.post(c,a,function(a){if(a.council&&a.council.name&&a.council.url)b.find("a").attr("href",a.council.url),b.find("span.destination").text(" on the "+a.council.name+" website"),b.removeClass("hidden");else if(a.council&&a.council.name&&a.council.contact_address){var c=$("#authority-contact");c.find("a.url").attr("href",a.council.contact_url).text(a.council.name);var e=c.find("div.adr").empty();for(var f=0,g=a.council.contact_address.length;f<g;f++)e.append(a.council.contact_address[f]).append("<br>");e.append(document.createElement("br")),c.find("div.tel .value").text(a.council.contact_phone),c.removeClass("hidden"),$("#no-provider-error").addClass("hidden")}else d="Sorry, we couldn't find details of a provider for that service in your area.",$("#no-provider-error").text(d).removeClass("hidden"),$("#authority-contact").addClass("hidden"),$("input[name=postcode]").attr("aria-labelledby","no-provider-error");$("#location-loading").addClass("hidden")})}function d(){$("#no-provider-error").addClass("hidden"),$("#authority-contact").addClass("hidden"),b.addClass("hidden")}$(AlphaGeo).bind("location-completed",function(a){c()}),$(AlphaGeo).bind("location-removed",function(a){$(".location-placeholder").text(""),d()});var a=new AlphaGeoForm("#local-locator-form"),b=$(".get-started")};$(function(){$("#wrapper").attr("class").match(/local_transaction/)&&setup_local_transactions()}),$(document).ready(function(){var a=$("section.more");a.find(".js-tabs").length&&a.tabs()})